name: Exportar Diagrama y Notificar a Telegram

# Se ejecuta solo cuando hay un push en el archivo espec铆fico
on:
  push:
    paths:
      - 'doc/diagramaConceptual.drawio'

jobs:
  convert-and-send:
    runs-on: ubuntu-latest
    steps:
      # 1. Descargar el c贸digo del repositorio
      - name: Checkout del c贸digo
        uses: actions/checkout@v4

      # 2. Convertir el archivo .drawio a .jpg usando una Action existente
      - name: Convertir Draw.io a JPG
        uses: rlespinasse/drawio-export-action@v2
        with:
          path: doc/ # Carpeta donde buscar谩 archivos .drawio
          format: jpg
          output: export/ # Carpeta temporal donde guardar谩 la imagen generada

      # 3. Enviar la imagen generada a Telegram
      - name: Enviar a Telegram
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.ID_GROUP_TELEGRAM }}
          token: ${{ secrets.APIKEY_BOT_TELEGRAM }}
          # La acci贸n anterior genera el archivo con el mismo nombre pero extensi贸n .jpg
          # Si tu archivo es doc/diagramaConceptual.drawio, el output ser谩 export/doc/diagramaConceptual.jpg
          photo: export/doc/diagramaConceptual.jpg
          message: |
             **Diagrama Actualizado**
            
            Se ha detectado un cambio en el diagrama conceptual.
            Adjunto la nueva versi贸n en imagen.