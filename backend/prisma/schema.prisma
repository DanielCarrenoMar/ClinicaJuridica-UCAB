generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
}

//CONSIDERACIONES
/**
 * 1) Los nombres pasan a tener dos atributos (firstName, lastName) en vez de uno solo (fullName)
 */

enum CaseStatusType {
  OPEN
  IN_PROGRESS
  ON_PAUSE
  CLOSED
}

enum GenderType {
  M
  F
  O
}

enum ColaboratorType {
  STUDENT
  GRADUATE
  VOLUNTEER
}

enum IDType {
  V
  E
  J
}

enum WorkConditionType {
  EMPLOYER
  EMPLOYEE
  WORKER
  SELF_EMPLOYED
}

enum ActivityConditionType {
  HOUSEWIFE
  STUDENT
  RETIRED
  OTHER
}

enum WasteCollectionType {
  HOME_COLLECTION
  PUBLIC_CONTAINER
  NONE
}

enum WastewaterType {
  SEWER_OR_SEPTIC
  UNCONNECTED_TOILET
  LATRINE
  NONE
}

enum WaterServiceType {
  INDOOR
  OUTDOOR
  NONE
}

enum RoofMaterialType {
  WOOD_PALM_CARDBOARD
  ZINC_SHEET
  CONCRETE_OR_TILES
}

enum WallMaterialType {
  WASTE_MATERIALS
  BAHAREQUE
  UNPLASTERED_BLOCK
  PLASTERED_BLOCK
}

enum FloorMaterialType {
  DIRT
  CEMENT
  CERAMIC
  GRANITE_PARQUET_MARBLE
}

enum LegalAreaType {
  PERSONS
  GOODS
  CONTRACTS
  ORDINARY_COURTS
  CHILD_PROTECTION_COURTS
  SUCCESSIONS
  CRIMINAL_MATERIAL
  LABOR_MATERIAL
  COMMERCIAL_MATERIAL
  ADMINISTRATIVE_MATERIAL
  OTHERS
}

enum AppointmentStatus {
  SCHEDULED
  COMPLETED
  CANCELED
}

enum BeneficiaryType {
  DIRECT
  INDIRECT
}

model User {
  idUser    Int        @id //Cedula de identidad
  firstName String
  lastName  String
  gender    GenderType
  email     String     @unique
  isActive  Boolean    @default(true)
  password  String?

  // Relaciones
  caseStatus         CaseStatus[]
  colaborator        Colaborator?
  teacher            Teacher?
  apointments        Appointment[]
  caseAssignments    CaseAssignment[]
  caseActions        CaseAction[]
  executeActions     ExecuteAction[]
  attenpAppointments AttenpAppointment[]

  @@map("Users")
}

model Colaborator {
  idUser          Int             @id
  typeColaborator ColaboratorType

  idSubject Int?
  section   String?
  subject   Subject? @relation(fields: [idSubject, section], references: [idSubject, section])

  user User @relation(fields: [idUser], references: [idUser])

  @@map("Colaborators")
}

model Teacher {
  idUser  Int     @id
  isAdmin Boolean @default(false)

  user User @relation(fields: [idUser], references: [idUser])

  subjects Subject[]

  @@map("Teachers")
}

model Subject {
  idSubject Int // RNC
  section   String
  name      String

  idTeacher Int
  teacher   Teacher @relation(fields: [idTeacher], references: [idUser])

  colaborators Colaborator[]

  @@id([idSubject, section])
}

model CaseStatus {
  idCaseStatus Int            @default(autoincrement())
  idUser       Int
  idCase       Int
  statusCase   CaseStatusType

  User User @relation(fields: [idUser], references: [idUser])
  //Case Case @relation(fields: [idCase], references: [idCase])

  createdAt DateTime @default(now())

  @@id([idCaseStatus, idUser, idCase])
  @@map("CaseStatuses")
}

model Beneficiary {
  idBeneficiary Int        @id // Cedula
  firstName     String
  lastName      String
  idType        IDType
  birthDate     DateTime
  gender        GenderType

  idParish Int

  parish Parish @relation(fields: [idParish], references: [idParish])

  cases IsBeneficiaryOf[]

  @@map("Beneficiaries")
}

model Applicant {
  idApplicant              Int                    @id // Cedula de identidad
  firstName                String
  lastName                 String
  email                    String
  phoneCell                String
  phoneHome                String
  maritalStatus            String
  concubinage              Boolean
  isWorking                Boolean
  workCondition            WorkConditionType?
  isLookingJob             Boolean
  activityCondition        ActivityConditionType?
  isHouseHoldHead          Boolean
  educationLevel           Int // De 0 a 14
  educationMonths          Int
  educationLevelHousehold  Int? // De 0 a 14
  educationMonthsHousehold Int?

  // Vivienda
  typeResidence   String?
  roomsAmount     Int?
  bathroomsAmount Int?
  roofMaterial    RoofMaterialType?
  wallMaterial    WallMaterialType?
  floorMaterial   FloorMaterialType?

  // Servicios
  waterService      WaterServiceType?
  wastewaterService WastewaterType?
  wasteCollection   WasteCollectionType?

  // Falta lo de artefactos domesticos que no se 
  // si son respuestas SI o no o por que ahora es multivaluado

  idFamilyHouse Int
  familyHouse   FamilyHouse @relation(fields: [idFamilyHouse], references: [idFamilyHouse])

  cases Case[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("Applicants")
}

model Parish {
  idParish Int    @id @default(autoincrement())
  name     String

  idMunicipality Int
  municipality   Municipality @relation(fields: [idMunicipality], references: [idMunicipality])

  beneficiaries Beneficiary[]
  nucleus       Nucleus[]

  @@map("Parishes")
}

model Municipality {
  idMunicipality Int    @id @default(autoincrement())
  name           String

  idRegion Int
  region   Region   @relation(fields: [idRegion], references: [id])
  parishes Parish[]

  @@map("Municipalities")
}

model Region {
  id   Int    @id @default(autoincrement())
  name String

  municipalities Municipality[]

  @@map("Regions")
}

model FamilyHouse {
  idFamilyHouse          Int   @id @default(autoincrement())
  memberWorkingCount     Int
  membersNonWorkingCount Int
  childrens7to12Count    Int
  childrensStudentCount  Int
  monthlyIncome          Float

  applicants Applicant[]

  @@map("FamilyHouses")
}

model Case {
  idCase       Int     @id @default(autoincrement())
  description  String
  observations String?
  tramitType   Int // entre 0 y 85

  idLegalArea Int
  idCourt     Int?
  idApplicant Int
  idNucleus   Int

  legalArea LegalArea @relation(fields: [idLegalArea], references: [idLegalArea])
  court     Court?    @relation(fields: [idCourt], references: [idCourt])
  applicant Applicant @relation(fields: [idApplicant], references: [idApplicant])
  nucleus   Nucleus   @relation(fields: [idNucleus], references: [idNucleus])

  assignments   CaseAssignment[]
  actions       CaseAction[]
  beneficiaries IsBeneficiaryOf[]
  suportDocs    SuportDocument[]
  appointments  Appointment[]

  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  semester           Semester? @relation(fields: [semesterIdSemester], references: [idSemester])
  semesterIdSemester Int?

  @@map("Cases")
}

model SuportDocument {
  idCase           Int
  idSuportDocument Int    @default(autoincrement())
  typeDocument     String
  description      String

  case Case @relation(fields: [idCase], references: [idCase])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@id([idCase, idSuportDocument])
  @@map("SuportDocuments")
}

model Nucleus {
  idNucleus Int    @id @default(autoincrement())
  name      String

  idParish Int
  parish   Parish @relation(fields: [idParish], references: [idParish])

  cases Case[]

  @@map("Nucleus")
}

model Appointment {
  idCase            Int
  date              DateTime
  statusAppointment AppointmentStatus @default(SCHEDULED)
  observations      String?

  case Case @relation(fields: [idCase], references: [idCase])

  idUser             Int
  user               User                @relation(fields: [idUser], references: [idUser])
  attenpAppointments AttenpAppointment[]

  @@id([idCase, date])
  @@map("Appointments")
}

model LegalArea {
  idLegalArea   Int           @id @default(autoincrement())
  typeLegalArea LegalAreaType
  description   String
  subject       String // No se que es materia en Ambito Legal

  cases Case[]

  @@map("LegalAreas")
}

model CaseAssignment {
  idUser     Int
  idCase     Int
  idSemester Int
  startDate  DateTime  @default(now())
  endDate    DateTime?

  user     User     @relation(fields: [idUser], references: [idUser])
  case     Case     @relation(fields: [idCase], references: [idCase])
  semester Semester @relation(fields: [idSemester], references: [idSemester])

  @@id([idUser, idCase, idSemester])
  @@map("CaseAssignments")
}

model Semester {
  idSemester Int      @id @default(autoincrement())
  term       String // Ej: "2023-15", "2023-30"
  startDate  DateTime
  endDate    DateTime

  caseAssignments CaseAssignment[]
  cases           Case[]

  @@map("Semesters")
}

model Court {
  idCourt   Int    @id @default(autoincrement())
  typeCourt String
  name      String

  cases        Case[]
  recordCourts RecordCourt[]

  @@map("Courts")
}

model RecordCourt {
  idRecordCourt Int     @id @default(autoincrement())
  caseNumber    String
  year          Int
  observations  String?

  idCourt Int
  court   Court @relation(fields: [idCourt], references: [idCourt])

  documents DocumentRecordCourt[]

  createdAt DateTime @default(now())

  @@map("RecordCourts")
}

model DocumentRecordCourt {
  // Falta Complementar mejor esta tabla Falta Info
  idRecordCourt         Int
  idDocumentRecordCourt Int    @default(autoincrement())
  typeDocument          String

  recordCourt RecordCourt @relation(fields: [idRecordCourt], references: [idRecordCourt])

  createdAt DateTime @default(now())

  @@id([idRecordCourt, idDocumentRecordCourt])
  @@map("DocumentRecordCourts")
}

model CaseAction {
  idCase       Int
  idCaseAction Int    @default(autoincrement())
  title        String
  description  String

  case Case @relation(fields: [idCase], references: [idCase])

  idUser Int?

  user User? @relation(fields: [idUser], references: [idUser])

  createdAt      DateTime        @default(now())
  executeActions ExecuteAction[]

  @@id([idCaseAction, idCase])
  @@map("CaseActions")
}

model ExecuteAction {
  idUser       Int
  idCaseAction Int
  idCase       Int
  dateExecuted DateTime

  user   User       @relation(fields: [idUser], references: [idUser])
  action CaseAction @relation(fields: [idCaseAction, idCase], references: [idCaseAction, idCase])

  @@id([idUser, idCaseAction])
  @@map("ExecuteActions")
}

model IsBeneficiaryOf {
  idBeneficiary   Int
  idCase          Int
  description     String
  typeBeneficiary BeneficiaryType
  relationship    String

  beneficiary Beneficiary @relation(fields: [idBeneficiary], references: [idBeneficiary])
  case        Case        @relation(fields: [idCase], references: [idCase])

  @@id([idBeneficiary, idCase])
  @@map("IsBeneficiaryOf")
}

model AttenpAppointment {
  idUser Int
  idCase Int
  date   DateTime

  user        User        @relation(fields: [idUser], references: [idUser])
  appointment Appointment @relation(fields: [idCase, date], references: [idCase, date])

  @@id([idUser, idCase, date])
  @@map("AttendAppointments")
}
